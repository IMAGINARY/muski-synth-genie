{"mappings":"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","sources":["src/lib/ts/index.ts","src/lib/ts/synth-genie.ts","src/lib/scss/synth-genie.module.scss","src/lib/ts/util.ts","src/lib/ts/segments.ts"],"sourcesContent":["import SynthGenie from './synth-genie';\nimport type {\n  // Workaround because TypeScript currently can't re-export types via \"export * from '...'\"\n  SynthGenieOptions as ISynthGenieOptions,\n} from './synth-genie';\n\nexport * from './synth-genie';\nexport default SynthGenie;\n\nexport type SynthGenieOptions = ISynthGenieOptions;\n","/* eslint-disable no-console */\nimport { tf, PianoGenie } from '@magenta/music';\nimport * as Tone from 'tone';\nimport { ResizeObserver as ResizeObserverPolyfill } from '@juggle/resize-observer';\nimport { strict as assert } from 'assert';\n\nimport classes from '../scss/synth-genie.module.scss';\nimport { getRelativePointerPosition, getCurvePoints, clamp } from './util';\nimport Segments from './segments';\n\n// eslint-disable-next-line compat/compat\nconst ResizeObserver = window.ResizeObserver || ResizeObserverPolyfill;\n\ntf.disableDeprecationWarnings();\n\nconst LOWEST_PIANO_KEY_MIDI_NOTE = 21;\nconst NUM_BUTTONS = 8;\n\nconst SYNTH_OPTIONS: ConstructorParameters<typeof Tone.AMSynth>[0] = {\n  volume: 0,\n  detune: 0,\n  portamento: 0,\n  harmonicity: 2.5,\n  oscillator: {\n    phase: 0,\n    type: 'fatsawtooth',\n    count: 3,\n    spread: 20,\n  },\n  envelope: {\n    attack: 0.1,\n    attackCurve: 'linear',\n    decay: 0.2,\n    decayCurve: 'exponential',\n    release: 0.3,\n    releaseCurve: 'exponential',\n    sustain: 0.2,\n  },\n  modulation: {\n    phase: 0,\n    type: 'square',\n  },\n  modulationEnvelope: {\n    attack: 0.5,\n    attackCurve: 'linear',\n    decay: 0.01,\n    decayCurve: 'exponential',\n    release: 0.5,\n    releaseCurve: 'exponential',\n    sustain: 1,\n  },\n};\n\nfunction computeAllowedPianoKeys(minMidiNote: number, maxMidiNote: number) {\n  assert(minMidiNote + 2 <= maxMidiNote);\n  const keyMin = Math.max(0, minMidiNote - LOWEST_PIANO_KEY_MIDI_NOTE);\n  const maxKey = Math.min(maxMidiNote - LOWEST_PIANO_KEY_MIDI_NOTE, 88 - 1);\n  const numKeys = Math.max(0, maxKey - keyMin + 1);\n  const keys = new Array(numKeys).fill(0).map((_, i) => keyMin + i);\n  return keys;\n}\n\nconst TEMPERATURE = 0.25;\n\nexport type SynthGenieOptions = {\n  resetStateOnLoop: boolean;\n  sustainInSegments: boolean;\n  slideInSegments: boolean;\n  numBeats: number;\n  mute: boolean;\n  volume: number;\n  pause: boolean;\n  beatLength: number;\n  relativeNoteLength: number;\n  minMidiNote: number;\n  maxMidiNote: number;\n  showGrid: boolean;\n  showBar: boolean;\n  gridColor: string;\n  barColor: string;\n  activeCellColor: string;\n  dotColor: string;\n  relativeDotSize: number;\n  lineColor: string;\n  relativeLineWidth: number;\n};\n\nconst defaultOptions: Readonly<SynthGenieOptions> = {\n  resetStateOnLoop: true,\n  sustainInSegments: true,\n  slideInSegments: false,\n  numBeats: 16,\n  mute: false,\n  volume: 0.75,\n  pause: false,\n  beatLength: 240,\n  relativeNoteLength: 0.9,\n  minMidiNote: 21,\n  maxMidiNote: 108,\n  showGrid: false,\n  showBar: false,\n  gridColor: '#b3b2b2',\n  barColor: 'rgba(211,211,211,0.4)',\n  activeCellColor: '#b3b2b2',\n  dotColor: '#2c2c2c',\n  relativeDotSize: 0.0,\n  lineColor: '#2c2c2c',\n  relativeLineWidth: 0.6,\n};\n\ntype RenderingContext2D =\n  | CanvasRenderingContext2D\n  | OffscreenCanvasRenderingContext2D;\n\ntype CellData = {\n  cellX: number;\n  cellY: number;\n};\n\nexport default class SynthGenie<T extends Element> {\n  protected handlers = this.getHandlers();\n\n  public readonly element: T;\n\n  protected pane: HTMLDivElement;\n\n  protected pointers: Map<number, CellData>;\n\n  protected canvas: HTMLCanvasElement;\n\n  protected context: RenderingContext2D;\n\n  protected segments: Segments<number> = new Segments(\n    defaultOptions.numBeats,\n    () => -1,\n  );\n\n  protected _position = 0;\n\n  protected genie: PianoGenie;\n\n  protected _volume: number = defaultOptions.volume;\n\n  protected _mute: boolean = defaultOptions.mute;\n\n  protected gain: Tone.Gain;\n\n  protected _beatLength: number = defaultOptions.beatLength;\n\n  protected _relativeNoteLength: number = defaultOptions.relativeNoteLength;\n\n  protected _minMidiNote: number = defaultOptions.minMidiNote;\n\n  protected _maxMidiNote: number = defaultOptions.maxMidiNote;\n\n  protected allowedPianoKeys: number[] = [];\n\n  public resetStateOnLoop: boolean = defaultOptions.resetStateOnLoop;\n\n  public sustainInSegments: boolean = defaultOptions.sustainInSegments;\n\n  public slideInSegments: boolean = defaultOptions.slideInSegments;\n\n  protected _showGrid: boolean = defaultOptions.showGrid;\n\n  protected _showBar: boolean = defaultOptions.showBar;\n\n  protected _gridColor: string = defaultOptions.gridColor;\n\n  protected _barColor: string = defaultOptions.barColor;\n\n  protected _activeCellColor: string = defaultOptions.activeCellColor;\n\n  protected _dotColor: string = defaultOptions.dotColor;\n\n  protected _relativeDotSize: number = defaultOptions.relativeDotSize;\n\n  protected _lineColor: string = defaultOptions.lineColor;\n\n  protected _relativeLineWidth: number = defaultOptions.relativeLineWidth;\n\n  protected synthOptions: ConstructorParameters<typeof Tone.AMSynth>[0];\n\n  protected synthPool: Tone.AMSynth[];\n\n  protected synth: Tone.AMSynth | null;\n\n  protected beatTimer: ReturnType<typeof setInterval> | 0;\n\n  protected repaintTimer: ReturnType<typeof setTimeout> | 0;\n\n  protected canvasTargetSize: { width: number; height: number } = {\n    width: 0,\n    height: 0,\n  };\n\n  protected initPromise: Promise<void> | null = null;\n\n  protected constructor(\n    element: T,\n    checkpoint: URL,\n    options: Partial<SynthGenieOptions> = {},\n  ) {\n    const canvas = document.createElement('canvas');\n    canvas.width = 0;\n    canvas.height = 0;\n    const context = canvas.getContext('2d');\n    assert(context !== null);\n\n    const pane = document.createElement('div');\n    pane.setAttribute('touch-action', 'none'); // for Pointer Events Polyfill\n    pane.classList.add(classes.pane);\n    pane.addEventListener('pointerdown', this.handlers.addPointer);\n    pane.addEventListener('pointerup', this.handlers.removePointer);\n    pane.addEventListener('pointercancel', this.handlers.removePointer);\n    pane.addEventListener('contextmenu', (event) => event.preventDefault());\n    pane.appendChild(canvas);\n\n    while (element.firstChild) element.firstChild.remove();\n    element.appendChild(pane);\n\n    this.element = element;\n    this.pane = pane;\n    this.canvas = canvas;\n    this.context = context;\n    const resizeObserver = new ResizeObserver((entries) => {\n      entries.forEach((entry) => {\n        const { width, height } = entry.contentRect;\n        this.canvasTargetSize = { width, height };\n        this.scheduleRepaint();\n      });\n    });\n    resizeObserver.observe(pane);\n\n    this.pointers = new Map();\n\n    this.genie = new PianoGenie(checkpoint.href);\n    this.gain = new Tone.Gain(1).toDestination();\n\n    this.synthOptions = SYNTH_OPTIONS;\n    this.synthPool = [];\n    this.synth = null;\n    this.beatTimer = 0;\n    this.repaintTimer = 0;\n\n    const optionsWithDefaults = { ...defaultOptions, ...options };\n    Object.assign(this, optionsWithDefaults);\n    this.repaint();\n  }\n\n  static async create<T extends Element>(\n    element: T,\n    checkpoint: URL,\n    options: Partial<SynthGenieOptions> = {},\n  ) {\n    // do not start playback before everything is initialized\n    const pauseState = options.pause ?? defaultOptions.pause;\n    const synthGenie = new SynthGenie<T>(element, checkpoint, {\n      ...options,\n      pause: true,\n    });\n    await synthGenie.init();\n    synthGenie.pause = pauseState;\n\n    return synthGenie;\n  }\n\n  get numBeats(): number {\n    return this.segments.size;\n  }\n\n  set numBeats(b: number) {\n    this.segments.resize(Math.max(1, Math.floor(b)));\n    this.scheduleRepaint();\n  }\n\n  get position(): number {\n    return this._position;\n  }\n\n  set position(p: number) {\n    this._position = clamp(Math.floor(p), 0, this.segments.size - 1);\n    this.scheduleRepaint();\n  }\n\n  protected updateGain() {\n    this.gain.gain.linearRampTo(this.mute ? 0 : this.volume, 0.1);\n  }\n\n  get mute(): boolean {\n    return this._mute;\n  }\n\n  set mute(m: boolean) {\n    this._mute = m;\n    this.updateGain();\n  }\n\n  get volume(): number {\n    return this._volume;\n  }\n\n  set volume(v: number) {\n    this._volume = Math.max(0, v);\n    this.updateGain();\n  }\n\n  get beatLength(): number {\n    return this._beatLength;\n  }\n\n  set beatLength(l: number) {\n    const pauseState = this.pause;\n    this.pause = true;\n    this._beatLength = Math.max(0, l);\n    this.pause = pauseState;\n  }\n\n  get relativeNoteLength(): number {\n    return this._relativeNoteLength;\n  }\n\n  set relativeNoteLength(l: number) {\n    this._relativeNoteLength = Math.max(0, l);\n  }\n\n  get minMidiNote(): number {\n    return this._minMidiNote;\n  }\n\n  set minMidiNote(n: number) {\n    this._minMidiNote = clamp(n, 0, 127 - 2);\n    this._maxMidiNote = Math.max(this._minMidiNote + 2, this._maxMidiNote);\n    this.updateAllowedPianoKeys();\n  }\n\n  get maxMidiNote(): number {\n    return this._maxMidiNote;\n  }\n\n  set maxMidiNote(n: number) {\n    this._maxMidiNote = clamp(n, 2, 127);\n    this._minMidiNote = Math.min(this._minMidiNote, this._maxMidiNote - 2);\n    this.updateAllowedPianoKeys();\n  }\n\n  get showGrid(): boolean {\n    return this._showGrid;\n  }\n\n  set showGrid(val: boolean) {\n    this._showGrid = val;\n    this.scheduleRepaint();\n  }\n\n  get showBar(): boolean {\n    return this._showBar;\n  }\n\n  set showBar(val: boolean) {\n    this._showBar = val;\n    this.scheduleRepaint();\n  }\n\n  get gridColor(): string {\n    return this._gridColor;\n  }\n\n  set gridColor(c: string) {\n    this._gridColor = c;\n    this.scheduleRepaint();\n  }\n\n  get barColor(): string {\n    return this._barColor;\n  }\n\n  set barColor(c: string) {\n    this._barColor = c;\n    this.scheduleRepaint();\n  }\n\n  get activeCellColor(): string {\n    return this._activeCellColor;\n  }\n\n  set activeCellColor(c: string) {\n    this._activeCellColor = c;\n    this.scheduleRepaint();\n  }\n\n  get dotColor(): string {\n    return this._dotColor;\n  }\n\n  set dotColor(c: string) {\n    this._dotColor = c;\n    this.scheduleRepaint();\n  }\n\n  get relativeDotSize(): number {\n    return this._relativeDotSize;\n  }\n\n  set relativeDotSize(s: number) {\n    this._relativeDotSize = Math.max(0, s);\n    this.scheduleRepaint();\n  }\n\n  get lineColor(): string {\n    return this._lineColor;\n  }\n\n  set lineColor(c: string) {\n    this._lineColor = c;\n    this.scheduleRepaint();\n  }\n\n  get relativeLineWidth(): number {\n    return this._relativeLineWidth;\n  }\n\n  set relativeLineWidth(w: number) {\n    this._relativeLineWidth = Math.max(0, w);\n    this.scheduleRepaint();\n  }\n\n  get(): SynthGenieOptions {\n    return Object.fromEntries(\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      Object.keys(defaultOptions).map((key) => [key, this[key] as unknown]),\n    ) as SynthGenieOptions;\n  }\n\n  set(options: Partial<SynthGenieOptions>) {\n    Object.assign(this, options);\n  }\n\n  get pause(): boolean {\n    return this.beatTimer === 0;\n  }\n\n  set pause(pause: boolean) {\n    if (pause && this.beatTimer !== 0) {\n      // pause\n      clearTimeout(this.beatTimer);\n      clearInterval(this.beatTimer);\n      this.beatTimer = 0;\n      if (this.synth !== null) {\n        this.releaseAndFreeSynth(this.synth, 0);\n        this.synth = null;\n      }\n    } else if (!pause && this.beatTimer === 0) {\n      // play\n      this.beatTimer = setTimeout(() => {\n        this.beatTimer = setInterval(() => this.playBeat(), this.beatLength);\n      }, 0);\n    }\n  }\n\n  protected playBeat() {\n    const { genie } = this;\n\n    this._position += 1;\n    if (this._position >= this.segments.size) {\n      this._position = 0;\n      if (this.resetStateOnLoop) genie.resetState();\n    }\n\n    const { segment, indexInSegment } = this.segments.getSegmentOf(\n      this._position,\n    );\n    const cell = segment[indexInSegment];\n    assert(typeof cell !== 'undefined');\n\n    if (this.synth !== null && cell === -1) {\n      // note still ringing, but shouldn't (grid values changed)\n      this.releaseAndFreeSynth(this.synth, 0);\n      this.synth = null;\n    }\n\n    if (cell !== -1) {\n      const frequency = this.getGenieFrequency(cell);\n\n      const attack =\n        this.synth === null || indexInSegment === 0 || !this.sustainInSegments;\n      const release =\n        indexInSegment === segment.length - 1 || !this.sustainInSegments;\n\n      this.synth = this.synth ?? this.synthPool.pop() ?? this.createSynth();\n\n      const noteDuration = (this._beatLength * this._relativeNoteLength) / 1000;\n\n      if (attack || !this.slideInSegments) {\n        // attack\n        this.synth.triggerAttack(frequency);\n      } else {\n        // ramp to next note frequency\n        this.synth.frequency.exponentialRampTo(frequency, noteDuration * 0.1);\n      }\n      if (release) {\n        // release note at the end of this cell\n        this.releaseAndFreeSynth(this.synth, noteDuration);\n        this.synth = null;\n      }\n    }\n\n    this.repaint();\n  }\n\n  createSynth() {\n    return new Tone.AMSynth(this.synthOptions).connect(this.gain);\n  }\n\n  releaseAndFreeSynth(synth: Tone.AMSynth, seconds: number) {\n    synth.triggerRelease(Tone.now() + seconds);\n    const releaseDuration = Tone.Time(synth.envelope.release).toSeconds();\n    const toneDuration = seconds + releaseDuration;\n    setTimeout(() => this.synthPool.push(synth), toneDuration * 1000);\n  }\n\n  getGenieFrequency(cell: number) {\n    const genieButton = NUM_BUTTONS - 1 - cell;\n    const pianoKey = this.genie.nextFromKeyList(\n      genieButton,\n      this.allowedPianoKeys,\n      TEMPERATURE,\n    );\n    const midiNote = LOWEST_PIANO_KEY_MIDI_NOTE + pianoKey;\n    const frequency = Tone.Frequency(midiNote, 'midi').toFrequency();\n    return frequency;\n  }\n\n  protected async init() {\n    if (this.initPromise !== null) {\n      await this.initPromise;\n    } else {\n      const { genie } = this;\n      await genie.initialize();\n      console.log('🧞‍♀️ ready!');\n    }\n  }\n\n  protected getHandlers() {\n    return {\n      addPointer: this.addPointer.bind(this),\n      updatePointer: this.updatePointer.bind(this),\n      removePointer: this.removePointer.bind(this),\n    };\n  }\n\n  getCellCoordinates(relX: number, relY: number) {\n    const cellX = Math.floor(relX * this.numBeats);\n    const cellY = Math.floor(relY * NUM_BUTTONS);\n    return { cellX, cellY };\n  }\n\n  protected addPointer(pe: PointerEvent) {\n    this.removePointer(pe);\n    this.pane.addEventListener('pointermove', this.handlers.updatePointer);\n    this.pane.setPointerCapture(pe.pointerId);\n\n    const { relX, relY } = getRelativePointerPosition(pe, this.pane);\n    const { cellX, cellY } = this.getCellCoordinates(relX, relY);\n    this.pointers.set(pe.pointerId, { cellX, cellY });\n\n    const { segments } = this;\n    segments.isolate(cellX);\n    segments.set(cellX, cellY);\n\n    this.repaint();\n  }\n\n  protected updateAllowedPianoKeys() {\n    this.allowedPianoKeys = computeAllowedPianoKeys(\n      this._minMidiNote,\n      this._maxMidiNote,\n    );\n  }\n\n  protected updatePointer(pe: PointerEvent) {\n    if (pe.buttons === 0) return;\n\n    const id = pe.pointerId;\n    const { relX, relY } = getRelativePointerPosition(pe, this.pane);\n    const pointerData = this.pointers.get(id);\n    assert(typeof pointerData !== 'undefined');\n    const { cellX: prevCellX, cellY: prevCellY } = pointerData;\n\n    const { cellX, cellY } = this.getCellCoordinates(relX, relY);\n    this.pointers.set(id, { cellX, cellY });\n\n    const { segments } = this;\n    if (prevCellX === cellX) {\n      // same x cell\n      if (prevCellY !== cellY) {\n        // different y cell\n        if (cellY < 0 || cellY >= NUM_BUTTONS) {\n          // out of y range\n          segments.isolate(cellX);\n          segments.set(cellX, -1);\n        } else {\n          // within y range\n          segments.set(cellX, cellY);\n        }\n        this.repaint();\n      }\n    } else {\n      // different x cell (possibly with some columns in between)\n      const [previousSegmentIndex, segmentIndex] = this.connectCells(\n        pointerData,\n        { cellX, cellY },\n      );\n      if (\n        prevCellX !== -1 &&\n        cellX !== -1 &&\n        previousSegmentIndex !== segmentIndex\n      ) {\n        if (prevCellX < cellX) {\n          segments.splitAfter(cellX);\n        } else {\n          segments.splitBefore(cellX);\n        }\n      }\n      this.repaint();\n    }\n  }\n\n  protected connectCells(first: CellData, second: CellData): [number, number] {\n    if (second.cellX < first.cellX) {\n      const [secondSegmentIndex, firstSegmentIndex] = this.connectCells(\n        second,\n        first,\n      );\n      return [firstSegmentIndex, secondSegmentIndex];\n    }\n\n    const { cellX: x0, cellY: y0 } = first;\n    const { cellX: x1, cellY: y1 } = second;\n\n    const slope = (y1 - y0) / (x1 - x0);\n\n    const { segments } = this;\n    const [firstSegmentIndex, secondSegmentIndex] = segments.join(x0, x1);\n\n    const clampedX0 = Math.min(segments.size - 1, Math.max(x0, 0));\n    const clampedX1 = Math.min(segments.size - 1, Math.max(x1, 0));\n    for (let x = clampedX0; x <= clampedX1; x += 1) {\n      const y = Math.floor(y0 + slope * (x - x0));\n      if (y < 0 || y >= NUM_BUTTONS) {\n        // make it possible to disable columns by dragging them out of the y range\n        segments.isolate(x);\n        segments.set(x, -1);\n      } else {\n        segments.set(x, y);\n      }\n    }\n\n    return [firstSegmentIndex, secondSegmentIndex];\n  }\n\n  protected removePointer(pe: PointerEvent) {\n    const id = pe.pointerId;\n\n    this.pointers.delete(id);\n\n    if (this.pointers.size === 0)\n      this.pane.removeEventListener('pointermove', this.handlers.updatePointer);\n  }\n\n  public clear() {\n    this.segments.set(0, ...Array<number>(this.segments.size).fill(-1));\n    this._position = 0;\n    this.repaint();\n    this.genie.resetState();\n  }\n\n  public repaint() {\n    if (this.repaintTimer !== 0) {\n      clearTimeout(this.repaintTimer);\n      this.repaintTimer = 0;\n    }\n\n    const { canvas, context, canvasTargetSize } = this;\n\n    if (canvas.width !== canvasTargetSize.width)\n      canvas.width = canvasTargetSize.width;\n    if (canvas.height !== canvasTargetSize.height)\n      canvas.height = canvasTargetSize.height;\n\n    context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    if (this._showBar) {\n      this.paintBar();\n    }\n    if (this._showGrid) {\n      this.paintCells();\n      this.paintGrid();\n    }\n\n    this.paintSegments();\n  }\n\n  public scheduleRepaint() {\n    if (this.repaintTimer === 0) {\n      this.repaintTimer = setTimeout(() => this.repaint(), 0);\n    }\n  }\n\n  protected paintSegments() {\n    const { segments, canvas } = this;\n\n    // compute segments\n    const controlPointsPerSegment: { x: number; y: number }[][] = [];\n    const stepX = canvas.width / segments.size;\n    const stepY = canvas.height / NUM_BUTTONS;\n    let cellX = 0;\n    for (let i = 0; i < segments.numSegments; i += 1) {\n      const segment = segments.getSegment(i);\n      const controlPoints: { x: number; y: number }[] = [];\n      assert(typeof segment !== 'undefined');\n      for (let j = 0; j < segment.length; j += 1) {\n        const cellY = segment[j];\n        if (cellY >= 0) {\n          const x = stepX * (0.5 + cellX);\n          const y = stepY * (0.5 + cellY);\n          controlPoints.push({ x, y });\n        }\n        cellX += 1;\n      }\n      controlPointsPerSegment.push(controlPoints);\n    }\n\n    const minCellDim = Math.min(\n      canvas.height / NUM_BUTTONS,\n      canvas.width / segments.size,\n    );\n\n    const { context, relativeDotSize, dotColor, relativeLineWidth, lineColor } =\n      this;\n\n    context.save();\n    const dotRadius = minCellDim * relativeDotSize * 0.5;\n    if (dotRadius > 0) {\n      context.fillStyle = dotColor;\n      controlPointsPerSegment.forEach((controlPoints) =>\n        controlPoints.forEach(({ x, y }) => {\n          context.beginPath();\n          context.ellipse(x, y, dotRadius, dotRadius, 0, 0, 2 * Math.PI);\n          context.closePath();\n          context.fill();\n        }),\n      );\n    }\n\n    const lineWidth = minCellDim * relativeLineWidth;\n    if (lineWidth > 0) {\n      context.beginPath();\n      context.strokeStyle = lineColor;\n      context.lineWidth = lineWidth;\n      context.lineCap = 'round';\n      context.lineJoin = 'round';\n      controlPointsPerSegment.forEach((controlPoints) => {\n        if (controlPoints.length === 1) {\n          const [{ x, y }] = controlPoints;\n          context.moveTo(x, y);\n          context.lineTo(x, y);\n        } else if (controlPoints.length === 2) {\n          const [{ x: x0, y: y0 }, { x: x1, y: y1 }] = controlPoints;\n          context.moveTo(x0, y0);\n          context.lineTo(x1, y1);\n        } else if (controlPoints.length >= 3) {\n          const points = getCurvePoints(controlPoints, 0.35);\n          const firstPoint = points.shift();\n          assert(typeof firstPoint !== 'undefined');\n\n          context.moveTo(firstPoint.x, firstPoint.y);\n          points.forEach(({ x, y }) => context.lineTo(x, y));\n        }\n      });\n      context.stroke();\n      context.closePath();\n    }\n    context.restore();\n  }\n\n  protected paintGrid() {\n    const { canvas, context, segments } = this;\n\n    context.save();\n    context.beginPath();\n    context.strokeStyle = this.gridColor;\n    const stepX = canvas.width / segments.size;\n    for (let i = 1; i < segments.size; i += 1) {\n      const x = stepX * i;\n      context.moveTo(x, 0);\n      context.lineTo(x, canvas.height);\n    }\n    const stepY = canvas.height / NUM_BUTTONS;\n    for (let i = 1; i < NUM_BUTTONS; i += 1) {\n      const y = stepY * i;\n      context.moveTo(0, y);\n      context.lineTo(canvas.width, y);\n    }\n    context.stroke();\n    context.closePath();\n    context.restore();\n  }\n\n  protected paintCells() {\n    const { canvas, context, segments } = this;\n\n    context.save();\n    context.beginPath();\n    context.fillStyle = this.activeCellColor;\n    const stepX = canvas.width / segments.size;\n    const stepY = canvas.height / NUM_BUTTONS;\n    let cellX = 0;\n    for (let i = 0; i < this.segments.numSegments; i += 1) {\n      const segment = this.segments.getSegment(i);\n      assert(typeof segment !== 'undefined');\n      for (let j = 0; j < segment.length; j += 1) {\n        const cellY = segment[j];\n        if (cellY >= 0) {\n          const x = stepX * cellX;\n          const y = stepY * cellY;\n          context.rect(x, y, stepX, stepY);\n        }\n        cellX += 1;\n      }\n    }\n    context.fill();\n    context.closePath();\n    context.restore();\n  }\n\n  protected paintBar() {\n    const { canvas, context } = this;\n\n    context.save();\n    context.fillStyle = this.barColor;\n    const stepX = canvas.width / this.numBeats;\n    const x = stepX * this._position;\n    context.fillRect(x, 0, stepX, canvas.height);\n    context.restore();\n  }\n}\n\nexport { defaultOptions };\n",".pane {\n  position: relative;\n  min-width: 64px;\n  min-height: 32px;\n  overflow: hidden;\n}\n\n.pane,\n.pane * {\n  touch-action: none;\n}\n\n.pane,\n.pane > canvas {\n  position: relative;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  width: 100%;\n  height: 100%;\n  padding: 0;\n  margin: 0;\n}\n","function getRelativePointerPosition(pe: PointerEvent, elem: HTMLElement) {\n  const { left, top, width, height } = elem.getBoundingClientRect();\n  const x = pe.clientX - left;\n  const y = pe.clientY - top;\n  const relX = x / width;\n  const relY = y / height;\n  return { x, y, relX, relY, width, height };\n}\n\nfunction getCurvePoints(\n  points: { x: number; y: number }[],\n  tension = 0.5,\n  isClosed = false,\n  numOfSegments = 16,\n): { x: number; y: number }[] {\n  // convert to internal format\n  const pts = new Array<number>();\n  points.forEach(({ x, y }) => pts.push(x, y));\n\n  // The algorithm require a previous and next point to the actual point array.\n  // Check if we will draw closed or open curve.\n  // If closed, copy end points to beginning and first points to end\n  // If open, duplicate first points to beginning, end points to end\n  const firstPoint = points[0];\n  const lastPoint = points[points.length - 1];\n  if (isClosed) {\n    pts.unshift(lastPoint.x, lastPoint.y);\n    pts.unshift(lastPoint.x, lastPoint.y);\n    pts.push(firstPoint.x, firstPoint.y);\n  } else {\n    pts.unshift(firstPoint.x, firstPoint.y); // copy 1. point and insert at beginning\n    pts.push(lastPoint.x, lastPoint.y); // copy last point and append\n  }\n\n  // ok, lets start..\n  const res = new Array<{ x: number; y: number }>();\n\n  // 1. loop goes through point array\n  // 2. loop goes through each segment between the 2 pts + 1e point before and after\n  for (let i = 2; i < pts.length - 4; i += 2) {\n    for (let t = 0; t <= numOfSegments; t += 1) {\n      // calc tension vectors\n      const t1x = (pts[i + 2] - pts[i - 2]) * tension;\n      const t2x = (pts[i + 4] - pts[i]) * tension;\n\n      const t1y = (pts[i + 3] - pts[i - 1]) * tension;\n      const t2y = (pts[i + 5] - pts[i + 1]) * tension;\n\n      // calc step\n      const st = t / numOfSegments;\n\n      // calc cardinals\n      const c1 = 2 * st ** 3 - 3 * st ** 2 + 1;\n      const c2 = -(2 * st ** 3) + 3 * st ** 2;\n      const c3 = st ** 3 - 2 * st ** 2 + st;\n      const c4 = st ** 3 - st ** 2;\n\n      // calc x and y cords with common control vectors\n      const x = c1 * pts[i] + c2 * pts[i + 2] + c3 * t1x + c4 * t2x;\n      const y = c1 * pts[i + 1] + c2 * pts[i + 3] + c3 * t1y + c4 * t2y;\n\n      // store points in array\n      res.push({ x, y });\n    }\n  }\n\n  return res;\n}\n\nfunction clamp(x: number, min: number, max: number): number {\n  return Math.max(min, Math.min(x, max));\n}\n\nexport { getRelativePointerPosition, getCurvePoints, clamp };\n","export default class Segments<T> {\n  protected segments: T[][];\n\n  public _size: number;\n\n  protected defaultValueCallback: () => T;\n\n  constructor(size: number, defaultValueCallback: () => T) {\n    this.segments = [new Array(size).fill(undefined).map(defaultValueCallback)];\n    this._size = size;\n    this.defaultValueCallback = defaultValueCallback;\n  }\n\n  get size() {\n    return this._size;\n  }\n\n  get numSegments() {\n    return this.segments.length;\n  }\n\n  findSegmentIndex(x: number): {\n    segmentIndex: number;\n    indexInSegment: number;\n  } {\n    let numElements = 0;\n    let segmentIndex = 0;\n    while (\n      segmentIndex < this.segments.length &&\n      numElements + this.segments[segmentIndex].length <= x\n    ) {\n      numElements += this.segments[segmentIndex].length;\n      segmentIndex += 1;\n    }\n    const indexInSegment = x - numElements;\n    return { segmentIndex, indexInSegment };\n  }\n\n  get(x: number, defaultValue: T): T;\n  get(x: number): T | undefined;\n  get(x: number, defaultValue?: T): T | undefined {\n    if (x < 0 || x >= this.size) return defaultValue ?? undefined; // out of range\n    const { segmentIndex, indexInSegment } = this.findSegmentIndex(x);\n    return this.segments[segmentIndex][indexInSegment];\n  }\n\n  set(x: number, ...values: T[]) {\n    if (x < 0 || x >= this.size) return; // out of range\n    let { segmentIndex, indexInSegment } = this.findSegmentIndex(x);\n    for (let i = 0; i < values.length; i += 1) {\n      this.segments[segmentIndex][indexInSegment] = values[i];\n      indexInSegment += 1;\n      if (indexInSegment >= this.segments[segmentIndex].length) {\n        segmentIndex += 1;\n        indexInSegment = 0;\n      }\n      if (segmentIndex > this.segments.length) break;\n    }\n  }\n\n  getSegment(which: number): T[] | undefined {\n    return this.segments[which];\n  }\n\n  getSegmentOf(x: number): { segment: T[]; indexInSegment: number } {\n    const { segmentIndex, indexInSegment } = this.findSegmentIndex(x);\n    return { segment: [...this.segments[segmentIndex]], indexInSegment };\n  }\n\n  getAllSegments() {\n    return this.segments.map((s) => [...s]);\n  }\n\n  /**\n   * Split segments before in front of x.\n   * @param x\n   */\n  splitBefore(x: number): number {\n    if (x < 0 || x >= this.size) return -1; // out of range\n\n    if (x === 0) return 0;\n\n    const { segmentIndex, indexInSegment } = this.findSegmentIndex(x);\n    if (indexInSegment === 0) {\n      // a segment starts at x -> no split necessary\n      return segmentIndex;\n    }\n\n    const segment = this.segments[segmentIndex];\n    const upper = segment.slice(indexInSegment);\n    const lower = segment.slice(0, indexInSegment);\n    this.segments.splice(segmentIndex, 1, lower, upper);\n\n    return segmentIndex + 1;\n  }\n\n  splitAfter(x: number): number {\n    if (x < 0 || x >= this.size) return -1; // out of range\n\n    if (x === this.size - 1) return this.size - 1;\n\n    return this.splitBefore(x + 1) + 1;\n  }\n\n  /** Split segment before and after x.\n   *\n   * @param x The index of the element to put into an isolated segment.\n   */\n  isolate(x: number): number {\n    this.splitAfter(x);\n    return this.splitBefore(x);\n  }\n\n  protected join1(x: number): number {\n    if (x <= 0 || x >= this.size) return -1; // out of range\n\n    const { segmentIndex, indexInSegment } = this.findSegmentIndex(x);\n    if (indexInSegment !== 0) this.joinSegments(segmentIndex);\n\n    return segmentIndex;\n  }\n\n  protected join2(x0: number, x1: number): [number, number] {\n    if (x0 > x1) {\n      const [segmentIndex1, segmentIndex0] = this.join2(x1, x0);\n      return [segmentIndex0, segmentIndex1];\n    }\n\n    if (x1 < 0 || x0 >= this.size) return [-1, -1];\n\n    const clampedX0 = Math.min(this.size - 1, Math.max(x0, 0));\n    const clampedX1 = Math.min(this.size - 1, Math.max(x1, 0));\n\n    const { segmentIndex: segmentIndex0 } = this.findSegmentIndex(clampedX0);\n    const { segmentIndex: segmentIndex1 } = this.findSegmentIndex(clampedX1);\n\n    for (let i = 0; i < segmentIndex1 - segmentIndex0; i += 1) {\n      this.joinSegments(segmentIndex0 + 1);\n    }\n\n    return [x0 < 0 ? -1 : segmentIndex0, x1 >= this.size ? -1 : segmentIndex1];\n  }\n\n  /**\n   * Join segments containing indices x-1 and x.\n   *\n   * @param x The index of the element to join with the element in front of it.\n   */\n  join(x: number): number;\n  /**\n   * Join all segments inbetween x0 and x1 (inclusive).\n   * @param x0 The index of the element in the first element.\n   * @param x1 The index of the element in the second element.\n   */\n  join(x0: number, x1: number): [number, number];\n  join(x0: number, x1?: number): number | [number, number] {\n    return typeof x1 === 'undefined' ? this.join1(x0) : this.join2(x0, x1);\n  }\n\n  /**\n   * Join the segment with the one in front of it.\n   *\n   * @param segmentIndex The index of the segment to join with its predecessor.\n   */\n  joinSegments(segmentIndex: number): number {\n    if (segmentIndex <= 0 || segmentIndex >= this.numSegments) return -1;\n\n    const lower = this.segments[segmentIndex - 1];\n    const upper = this.segments[segmentIndex];\n    this.segments.splice(segmentIndex, 1);\n    lower.push(...upper);\n\n    return segmentIndex - 1;\n  }\n\n  resize(size: number) {\n    if (size > this.size) {\n      const diff = size - this.size;\n      this.segments.push(\n        new Array(diff).fill(0).map(this.defaultValueCallback),\n      );\n      this._size = size;\n    } else if (size > 0 && size < this.size) {\n      this.splitBefore(size);\n      const { segmentIndex } = this.findSegmentIndex(size);\n      this.segments.splice(segmentIndex);\n      this._size = size;\n    }\n  }\n}\n"],"names":[],"version":3,"file":"index.js.map"}